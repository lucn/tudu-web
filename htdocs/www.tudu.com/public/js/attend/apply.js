var Attend=Attend||{};
Attend.Apply={editor:null,ccInput:null,targetInput:null,filedialog:null,upload:null,editorCss:{},init:function(a,c,d){var b=this;$('button[name="back"]').bind("click",function(){location=d});var e=$(window).height(),f=$(document.body).height(),e=Math.max($("#content").height()+(e-f-15),200);$("#content").css("height",e+"px");this.editor=new TOP.UEditor("content",{initialFrameHeight:e},window,jQuery,function(){a.editor&&this.disable();!this.hasContents()&&("undefined"!=typeof b.editorCss.fontfamily&&"undefined"!=
typeof b.editorCss.fontsize)&&this.setContent('<p style="font-family:'+b.editorCss.fontfamily+";font-size:"+b.editorCss.fontsize+'"></p>');this.commands.send={execCommand:function(){Attend.Apply.send("send")}};this.addshortcutkey({send:"ctrl+13"})},jQuery);$("#map-btn").click(function(){b.editor.getEditor().loadPlugin("googlemap",function(){b.editor.getEditor().plugin.mapDialog()})});this.ccInput=new TOP.ContactInput({id:"cc-input",target:$("#i-cc"),valuePlace:$("#cc"),group:!0,jq:jQuery});this.initSelectLink("#select-cc",
this.ccInput,$("#cc"),!0);c.init&&$("#row-target").size()&&(this.targetInput=new TOP.ContactInput({id:"target-input",target:$("#i-target"),valuePlace:$("#target"),group:!1,jq:jQuery,maxCount:1,depts:c.depts,contact:!1}),this.initSelectLink("#select-target",this.targetInput,$("#target"),!1,1,c.depts.join(","),["common"]),a.target&&this.targetInput.disabled());$("#add-cc").bind("click",function(){$(this).hasClass("disabled")||b.toggleCC()});$("#add-target").bind("click",function(){c.init&&!$(this).hasClass("disabled")&&
b.toggleTarget()});$("#period").bind("keyup",function(){this.value=this.value.replace(/[^0-9.]+/,"");if(this.value.indexOf(".")!=-1){var a=this.value.split(".");if(typeof a[1]!="undefined"&&a[1].length>2)this.value=a[0]+"."+a[1].substring(0,2)}}).blur(function(){$(this).val(this.value)});!TOP.Browser.isIE&&!TOP.Browser.isFF?$("#screencp-btn").remove():$("#link-capture").bind("click",function(){if(!Capturer.getCapturer())return Capturer.install();Capturer.setEditor(b.editor);Capturer.startCapture()});
$("#netdisk-btn").click(function(){if(b.filedialog===null)b.filedialog=new FileDialog({id:"netdisk-dialog"});b.filedialog.show()});$(':radio[name="categoryid"]').bind("click",function(){if(this.value=="^checkin"){$("#row-startdate").hide();$("#row-enddate").hide();$("#row-date").hide();$("#row-checkin").show();$("#row-checkintime").show();$("#row-total").hide();b.updateTimeInput(true)}else{b.changeCategory(this.value);$("#row-checkin").hide();$("#row-checkintime").hide();if(parseInt($(':radio[name="isallday"]:checked').val())){$("#row-startdate").show();
$("#row-enddate").show();$("#row-date").hide()}else{$("#row-startdate").hide();$("#row-enddate").hide();$("#row-date").show()}$("#row-total").show();b.updateTimeInput(false)}});$(':radio[name="isallday"]').bind("click",function(){if(parseInt(this.value)){$("#row-startdate").show();$("#row-enddate").show();$("#row-date").hide()}else{$("#row-startdate").hide();$("#row-enddate").hide();$("#row-date").show()}b.updateTimeInput(false)});$("#startdate").datepick({showOtherMonths:!0,selectOtherMonths:!0,
firstDay:0,showAnim:"slideDown",showSpeed:"fast",showTimePanel:!1,showButtonPanel:!1,onSelect:function(a){$("#enddate").datepick("option",{minDate:a});b.updateTimeInput(false)}});$("#enddate").datepick({showOtherMonths:!0,selectOtherMonths:!0,firstDay:0,showAnim:"slideDown",showSpeed:"fast",showTimePanel:!1,showButtonPanel:!1,onSelect:function(a){$("#startdate").datepick("option",{maxDate:a});b.updateTimeInput(false)}});$("#date").datepick({showOtherMonths:!0,selectOtherMonths:!0,firstDay:0,showAnim:"slideDown",
showSpeed:"fast",showTimePanel:!1,showButtonPanel:!1,onSelect:function(a){$("#dateEnd").datepick("option",{minDate:a});b.checkVal();b.updateTimeInput(false)}});$("#dateEnd").datepick({showOtherMonths:!0,selectOtherMonths:!0,firstDay:0,showAnim:"slideDown",showSpeed:"fast",showTimePanel:!1,showButtonPanel:!1,onSelect:function(a){$("#date").datepick("option",{maxDate:a});b.checkVal();b.updateTimeInput(false)}});$("#starthour").stepper({step:1,max:23,min:0,callback:function(){b.checkVal();b.updateTimeInput(false)}});
$("#startmin").stepper({step:15,max:59,min:0,callback:function(){b.checkVal();b.updateTimeInput(false)}});$("#endhour").stepper({step:1,max:23,min:0,callback:function(){b.checkVal();b.updateTimeInput(false)}});$("#endmin").stepper({step:15,max:59,min:0,callback:function(){b.checkVal();b.updateTimeInput(false)}});$("#checkindate").datepick({showOtherMonths:!0,selectOtherMonths:!0,firstDay:0,showAnim:"slideDown",showSpeed:"fast",showTimePanel:!1,showButtonPanel:!1,onSelect:function(){b.updateTimeInput(true)}});
$("#checkinhour").stepper({step:1,max:23,min:0,callback:function(){b.updateTimeInput(true)}});$("#checkinmin").stepper({step:15,max:59,min:0,callback:function(){b.updateTimeInput(true)}});$(':radio[name="checkintype"]').bind("click",function(){b.updateTimeInput(true)});$("#theform").submit(function(){return false});$('button[name="send"],button[name="save"]').bind("click",function(){$("#action").val(this.name);b.send(this.name)});$('button[name="preview"]').click(function(){b.getFormPreview("#theform",
"/app/attend/apply/preview","_blank")});setTimeout(function(){b.clearCast()},1E3)},updateTimeInput:function(a){if(a){if($(':radio[name="checkintype"]:checked').size()){var a=parseInt($(':radio[name="checkintype"]:checked').val()),c=$("#checkindate").val();if(c){var d=$("#checkinhour").val(),b=$("#checkinmin").val();a?($("#endtime").val(c+" "+d+":"+b),$("#starttime").val("")):($("#starttime").val(c+" "+d+":"+b),$("#endtime").val(""))}}}else if($(':radio[name="isallday"]:checked').size())if(parseInt($(':radio[name="isallday"]:checked').val()))a=
$("#startdate").val(),c=$("#enddate").val(),$("#starttime").val(a),$("#endtime").val(c);else{var e=$("#date").val();if(e){var f=$("#dateEnd").val();if(f){a=$("#starthour").val();d=$("#startmin").val();c=$("#endhour").val();b=$("#endmin").val();$("#starttime").val(e+" "+a+":"+d);$("#endtime").val(f+" "+c+":"+b);d=0;9>a&&(a=9);18<a&&(a=18);9>c&&(c=9);18<c&&(c=18);var b=new Date,g=new Date,j=e.split("-"),h=f.split("-");b.setFullYear(j[0]);b.setMonth(j[1]-1);b.setDate(j[2]);g.setFullYear(h[0]);g.setMonth(h[1]-
1);g.setDate(h[2]);if(e==f)0!=b.getDay()&&6!=b.getDay()&&(d=12>=a&&13<=c?parseInt(c)-parseInt(a)-1:parseInt(c)-parseInt(a));else{e=(g.getTime()-b.getTime())/1E3/60/60/24;0!=b.getDay()&&6!=b.getDay()&&(d=12>=a?d+(18-a-1):d+(18-a));0!=g.getDay()&&6!=g.getDay()&&(d=13<=c?d+(c-9-1):d+(c-9));d+=8*(e-1);for(a=1;a<=e-1;a++)if(c=new Date(b.getTime()+864E5*a),0==c.getDay()||6==c.getDay())d-=8}0>d&&(d=0);$("#period").val(d)}}}},checkVal:function(){var a=$("#date").val();if(a&&$("#dateEnd").val()){var c=new Date,
d=new Date,b=a.split("-"),a=a.split("-");c.setFullYear(b[0]);c.setMonth(b[1]);c.setDate(b[2]);d.setFullYear(a[0]);d.setMonth(a[1]);d.setDate(a[2]);if(!(d.getTime()>c.getTime())&&d.getTime()==c.getTime()){var b=$("#starthour").val(),a=$("#startmin").val(),e=$("#endhour").val(),f=$("#endmin").val();c.setHours(b);c.setMinutes(a);d.setHours(e);d.setMinutes(f);c.getTime()>d.getTime()&&($("#endhour").val(c.getHours()),$("#endmin").val(c.getMinutes()))}}},changeCategory:function(a){$.ajax({method:"GET",
dataType:"json",url:"/app/attend/apply/summary?categoryid="+a,success:function(c){if(c.success&&c.data){var d=$('label[for="c-'+a+'"]').text();$("#type-sum").text("\u672c\u6708\u5df2\u7533\u8bf7 "+d+" "+c.data.summary+" \u5c0f\u65f6")}},error:function(){}})},toggleCC:function(){$("#row-cc:visible").size()?($("#cc, #i-cc").attr("disabled",!0),$("#row-cc").hide(),$("#add-cc").text(TOP.TEXT.ADD_CC)):($("#cc, #i-cc").attr("disabled",!1),$("#row-cc").show(),$("#add-cc").text(TOP.TEXT.DELETE_CC))},toggleTarget:function(){$("#row-target:visible").size()?
($("#target, #i-target").attr("disabled",!0),$("#row-target").hide(),$("#type-sum").show(),$("#add-target").text("\u6dfb\u52a0\u4ee3\u529e")):($("#target, #i-target").attr("disabled",!1),$("#row-target").show(),$("#type-sum").hide(),$("#add-target").text("\u5220\u9664\u4ee3\u529e"))},getFormPreview:function(a,c,d){$("#postcontent").val(Attend.Apply.editor.getSource());var b=$(a).serializeArray(),a=$('<form action="'+c+'" method="post" target="'+d+'" style="display:none"></form>'),e;for(e in b)a.append('<textarea name="'+
b[e].name+'">'+b[e].value+"</textarea>");a.append('<input name="autosave" value="1" />');a.appendTo(document.body).submit()},clearCast:function(){var a=TOP.Cast.getTime();a&&$.ajax({type:"GET",dataType:"json",url:"/tudu/clear-cast?loadtime="+a,success:function(a){a.data&&a.data.clear&&TOP.Cast.clear()},error:function(){}})},initSelectLink:function(a,c,d,b,e,f,g){b||(b=!1);$(a).click(function(){$(this).text();var a=d.val(),h=[];if(a)for(var a=a.split("\n"),l=0,m=a.length;l<m;l++){var n=a[l].split(" ");
h.push({_id:n[0].replace(/^#+/,""),name:n[1]})}else h=null;var k=TOP.Frame.TempWindow;k.append('<div class="pop pop_linkman"><div class="pop_header"><strong>'+TOP.TEXT.SELECT_CONTACT+'</strong><a class="icon icon_close close"></a></div><div class="pop_body"></div><div class="pop_footer"><button type="button" name="confirm" class="btn">'+TOP.TEXT.CONFIRM+'</button><button type="button" class="btn close">'+TOP.TEXT.CANCEL+"</button></div></div>",{width:470,draggable:!0,onShow:function(){k.center()},
onClose:function(){k.destroy()}});a={appendTo:k.find("div.pop_body"),enableGroup:b,selected:h,maxCount:e,mailInput:c,childOf:void 0!==f?f:null};void 0!==e&&(a.maxSelect=e);void 0!==g&&(a.panels=g);var o=new TOP.ContactSelector(a);(a=TOP.Cookie.get("CONTACT-PANEL"))||(a="common");o.switchPanel(a);k.find('button[name="confirm"]').bind("click",function(){for(var a=o.getSelected(),b=0,d=a.length;b<d;b++){var e={};if(a[b].groupid){e.title=a[b].name+"&lt;"+TOP.TEXT.GROUP+"&gt;";e._id=a[b].groupid}else{e.title=
a[b].name+(a[b].email?"$lt;"+a[b].email+"&gt;":"");e._id=a[b].email?a[b].email:""}e.name=a[b].name;c.addItem(a[b].name,e)}k.close()});k.show()})},send:function(a,c){var d=$("#theform"),b=this;if("autosave"!=a){if(!$(':radio[name="categoryid"]:checked').size()&&!$("#categoryid").val())return TOP.showMessage("\u8bf7\u9009\u62e9\u7533\u8bf7\u7c7b\u578b");var e=d.find('input[name="categoryid"]:checked').val();if("^checkin"!=e&&!$(':radio[name="isallday"]:checked').size())return TOP.showMessage("\u8bf7\u9009\u62e9\u65f6\u95f4\u7c7b\u578b");
if("^checkin"==e&&!$(':radio[name="checkintype"]:checked').size())return TOP.showMessage("\u8bf7\u9009\u62e9\u8865\u7b7e\u7c7b\u578b");var f=this.ccInput.getItems();i=0;null!==this.targetInput&&this.targetInput.getItems().each(function(){$(this).attr("title")==TOP.TEXT.INVALID_TO_USER&&i++});f.each(function(){$(this).attr("title")==TOP.TEXT.INVALID_TO_USER&&i++});if(0<i)return TOP.showMessage(TOP.TEXT.TUDU_ACCEPTER_EMAIL_ERROR);if("^checkin"==e&&!$("#checkindate").val())return $("#checkindate").focus(),
TOP.showMessage("\u8bf7\u8f93\u5165\u8865\u7b7e\u65f6\u95f4");if("^checkin"!=e){e=$(':radio[name="isallday"]:checked').val();if(parseInt(e)){if(!$("#startdate").val())return $("#startdate").focus(),TOP.showMessage("\u8bf7\u8f93\u5165\u5f00\u59cb\u65f6\u95f4");if(!$("#enddate").val())return $("#enddate").focus(),TOP.showMessage("\u8bf7\u8f93\u5165\u7ed3\u675f\u65f6\u95f4")}else{if(!$("#date").val())return $("#date").focus(),TOP.showMessage("\u8bf7\u8f93\u5165\u5f00\u59cb\u65f6\u95f4");if(!$("#dateEnd").val())return $("#dateEnd").focus(),
TOP.showMessage("\u8bf7\u8f93\u5165\u7ed3\u675f\u65f6\u95f4")}if(!$("#period").val())return $("#period").focus(),TOP.showMessage("\u8bf7\u8f93\u5165\u7533\u8bf7\u5c0f\u65f6\u603b\u6570")}if(!TOP.Device.iOS&&!TOP.Device.Android&&null!==this.editor&&this.editor.isNull())return this.editor.focus(),TOP.showMessage("\u8bf7\u8f93\u5165\u7533\u8bf7\u7406\u7531")}if(TOP.Device.iOS||TOP.Device.Android)e=$("#content").val(),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />");else{e=this.editor.getSource();
if(!checkContentImage(e,this.editor,function(){b.send(a,c)}))return;f=/<img([^>]+)src="([^"]+)"([^>]+)_aid="([^"]+)"([^>]+)\/>/ig;for(d.find(':hidden[name="file[]"]').remove();null!=(result=f.exec(e));)d.append('<input type="hidden" name="file[]" value="'+result[4]+'" />');e=e.replace(f,'<img$1src="AID:$4"$3_aid="$4"$5/>');e=e.replace(/\s+id="[^"]+"/g,"")}$("#postcontent").val(e);"autosave"!=a&&(!whileUploading(this.upload,TOP.TEXT.WAITING_UPLOAD,function(){Modify.send(a,c)},d)||$("#attach-list div.upload_error").size()&&
!confirm(TOP.TEXT.COMPOSE_UPLOAD_FAILURE))||(e=d.serializeArray(),"autosave"!=a&&(TOP.showMessage(TOP.TEXT.POSTING_DATA,0,"success"),d.find(":input").attr("disabled",!0)),$.ajax({type:"POST",dataType:"json",data:e,url:d.attr("action"),success:function(b){a!="autosave"&&TOP.showMessage(b.message,5E3,b.success?"success":null);b.data&&$("#ftid").val(b.data.tuduid);if(b.success){if(typeof c=="function")return c();var e="";if(a=="send"&&b.data)location=e=typeof _NEW_WIN!="undefined"&&_NEW_WIN?"/app/attend/apply/view?tid="+
b.data.tuduid+"&newwin=1":"/app/attend/apply/view?tid="+b.data.tuduid;else d.find(":input:not([_disabled])").attr("disabled",false)}else d.find(":input:not([_disabled])").attr("disabled",false)},error:function(){d.find(":input:not([_disabled])").attr("disabled",false);a!="autosave"&&TOP.showMessage(TOP.TEXT.PROCESSING_ERROR)}}))}};
var FileDialog=function(a){this._settings=$.extend({},a);this.listCt=this._settings.listCt?this._settings.listCt:$("#attach-list");this.list=this._settings.list?this._settings.list:$("#attach-list td.bd_upload")};
FileDialog.filetpl=['<div class="filecell"><input type="hidden" name="nd-attach[]" value="" /><input type="hidden" name="attach[]" value="" /><div class="attsep"><div class="attsep_file"><span class="icon icon_add"></span><span class="filename"></span>&nbsp;<span class="filesize"></span></div>','<div class="attsep_del"><a href="javascript:void(0)" name="delete">'+TOP.TEXT.DELETE+"</a></div>",'<div class="clear"></div></div></div>'].join("");
FileDialog.tpl='<div class="pop pop_linkman"><div class="pop_header"><strong>'+TOP.TEXT.NETDISK_ATTACH+'</strong><a class="icon icon_close close"></a></div><div class="pop_body" style="padding:10px"><p class="gray">'+TOP.TEXT.SELECT_NETDISK_FILE+'</p></div><div class="pop_footer"><button type="button" name="confirm" class="btn">'+TOP.TEXT.CONFIRM+'</button><button type="button" name="cancel" class="btn close">'+TOP.TEXT.CANCEL+"</button></div></div>";
FileDialog.prototype={win:null,upload:null,_settings:null,list:null,listCt:null,init:function(){var a=TOP.Frame.TempWindow,c=this;a.append(FileDialog.tpl,this._settings.id,{width:300,draggable:!0,onClose:function(){a.destroy()}});this._settings.upload&&this.initUpload();var d=new TOP.NetdiskPanel;d.renderTo(a.find(".pop_body"));a.find('button[name="confirm"]').click(function(){for(var b=d.getFileSelected(),e=0,f=b.length;e<f;e++)b[e].fileid&&c.appendToAttachment(b[e].fileid,b[e].filename,b[e].filesize);
a.close()});a.show()},show:function(){this.init()},appendToAttachment:function(a,c,d){var b=this,e=$(FileDialog.filetpl);b.list.find("#nd-file-"+a).size()||(e.attr("id","nd-file-"+a).find(".filename").text(c),e.find(':hidden[name="nd-attach[]"]').val(a),e.find(':hidden[name="attach[]"]').val(a),d=1024<d?Math.round(d/1024,2)+"KB":d+"bytes",e.find(".filesize").text("("+d+")"),e.find('a[name="delete"]').click(function(){e.remove();b.list.find(".filecell").size()||b.listCt.hide()}),b.list.append(e),b.listCt.show())}};
var Capturer={capturer:null,editor:null,uploaddialog:null,uploadurl:null,installed:null,setEditor:function(a){this.editor=a},setUploadUrl:function(a){this.uploadurl=a},install:function(){var a=TOP.Frame.Dialog.show({title:TOP.TEXT.CAPTURER_INSTALL_TIPS,body:'<div class="screen_lock"><div><span class="icon icon_attention_big"></span><strong>'+TOP.TEXT.UNINSTALL_CAPTURER_TOOLS_TIPS+"</strong></div><ul><li>"+TOP.TEXT.AFFTER_INSTALL+TOP.TEXT.COMMA+TOP.TEXT.CLICK+'&nbsp;<span class="icon icon_screencp"></span><a>'+
TOP.TEXT.CAPTURER+"</a>&nbsp;"+TOP.TEXT.COMMA+TOP.TEXT.USE_CAPTURER_NOW+"</li></ul></div>",buttons:[{text:TOP.TEXT.INSTALL_ONLINE,cls:"btn",events:{click:function(){confirm(TOP.TEXT.INSTALL_LEAVE_CONFIRM)&&(top.location="/plugin/screencapture?back="+encodeURIComponent(TOP.Frame.hash()),a.close())}}},{text:TOP.TEXT.CANCEL,cls:"btn close",events:{click:function(){a.close()}}}]})},getCapturer:function(){if(null===this.capturer&&!1!==this.installed){var a=this;this.capturer=new ScreenCapture({onCaptured:function(){a.uploaddialog=
TOP.Frame.Dialog.show({body:"<div>"+TOP.TEXT.FILE_UPLOADING+'</div><div class="progress_large" style="width:420px;margin:10px 0"><div class="bar"></div></div>',title:TOP.TEXT.FILE_UPLOADING,close:!1}).getWin()},onUploaded:function(c){if(c){a.uploaddialog.dialog.container.find("div.progress_large div.bar").css("width","95%");c=c.HttpReault.match(/\{.*\}/);try{eval("ret="+c+";")}catch(d){}(void 0).fileid?null!==a.editor&&(html='<img src="/attachment/img?fid='+(void 0).fileid+'" _aid="'+(void 0).fileid+
'" /><br />',a.editor.pasteHTML(html)):TOP.showMessage(TOP.TEXT.CAPTURER_UPLOAD_FILE_ERROR)}else TOP.showMessage(TOP.TEXT.CAPTURER_START_UPLOAD_ERROR);setTimeout(function(){a.uploaddialog.hide()},500)},uploadUrl:a.uploadurl});if(!this.capturer.init())return this.capturer.destroy(),this.installed=!1,this.capturer=null}return this.capturer},startCapture:function(){this.getCapturer().startCapture()}};
function initAttachment(a,c,d){var b={buttonImageUrl:"",buttonWidth:"70",buttonHeight:"16",buttonTextLeftPadding:20,buttonTextTopPadding:1,buttonPlaceholderId:"upload-btn",postParams:{}},e;for(e in a)"undefined"!=typeof TuduUpload.defaults[e]&&(b[e]=a[e]);$(".upload_btn").mouseover(function(){$("#upload-link").css("text-decoration","underline")}).mouseout(function(){$("#upload-link").css("text-decoration","none")});a=new TuduUpload(b);b=new Tudu.Attachment;b.list=c;b.container=d;b.setUpload(a);return a}
function initPicInsert(a,c){var d=null,b=null,e=null,f=menuDialog("pic-dia",{body:$("#pic-modal"),oncreate:function(){$("#pic-modal .tab-header li a").click(function(){$("#pic-modal .tab-header li").removeClass("active");var a=$(this),b=a.attr("name");a.parent().addClass("active");$("#pic-modal div.tab-body").hide();$("#tb-"+b).show()});$('#pic-modal button[name="cancel"]').click(function(){f.hide()});$('#pic-modal button[name="confirm"]').click(function(){var a=$("#picurl").val();a&&d.pasteHTML('<img src="'+
a+'" alt="" /><br />',!0);f.hide()});if(c){var a={buttonWidth:"280",buttonHeight:"24",fileTypes:"*.jpg;*.jpeg;*.gif;*.png",buttonPlaceholderId:"pic-upload-btn",postParams:{}},h;for(h in c)"undefined"!=typeof TuduUpload.defaults[h]&&(a[h]=c[h]);$(".imgupload").mouseover(function(){$('button[name="browse"]').mouseover()}).mouseout(function(){$('button[name="browse"]').mouseout()});var g=$("#filename");b=new TuduUpload(a);e=new Tudu.EditorUpload({upload:b,onFileQueue:function(){var a=[],b;for(b in this._files)a.push(this._files[b].name);
g.val(a.join(","))}});$('button[name="upload"]').click(function(){e.startUpload()})}}});f.hide();for(var g in a)$(g).mousedown(function(a){TOP.stopEventBuddle(a)}).click(function(b){d=a["#"+this.id];TOP.stopEventBuddle(b);var c=$(this).offset(),g=c.left-22,c=c.top+16;null!=e&&(e.cleanFileQueue(),$("#filename").val(""),e.onComplete=function(){for(var a=0,b=this._success.length;a<b;a++){var c=this._success[a].aid;d.pasteHTML('<img src="/attachment/img?fid='+c+'" _aid="'+c+'" /><br />')}f.hide()});f.css({left:g,
top:c}).show();$("#pic-modal .tab-header li:eq(0) a").click();$("#picfile").val("");$("#picurl").val("http://");TOP.stopEventBuddle(b)})}
function menuDialog(a,c){if(a&&c.body){var d=$("#"+a);d.size()||(d=$("<div>").addClass("modal-dialog").attr("id",a),d.appendTo(c.appendTo?c.appendTo:document.body).bind("click",function(a){TOP.stopEventBuddle(a)}),"string"==typeof c.body?d.html(c.body):d.append(c.body.show()),"function"==typeof c.oncreate&&c.oncreate.call(d),$(window).bind("click",function(){d.hide()}),$("#replyform").bind("click",function(){d.hide()}));d.css({position:"absolute",zIndex:100,top:c.top?c.top+"px":0,left:c.left?c.left+
"px":0}).show();return d}}
function checkContentImage(a,c,d){var b=a.match(/<img[^>]+src="data:image\/\w+;base64,([^">]+)"([^>]+)\/>/ig);if(!b||!b.length)return!0;var e=TOP.Frame.Dialog.show({body:"<div>"+TOP.TEXT.IMG_UPLOADING+'</div><div class="progress_upload"></div>',title:TOP.TEXT.FILE_UPLOADING,close:!1}).getWin();e.show();for(var f=0,g=b.length,j=[],h=0;h<g;h++){var l=b[h],m=l.match(/data:image\/\w+;base64,[^"]+/ig);j[j.length]=l;m.length?(m=m[0].split(",")[1],$.ajax({url:"/attachment/proxy",type:"POST",dataType:"json",
data:{data:m,label:h},success:function(b){if(b.success&&b.data){var h=j[b.data.label],b=h.replace(/src="[^"]+"/,'src="/attachment/img?fid='+b.data.fileid+'"').replace(">",'_aid="'+b.data.fileid+'" >');a=a.replace(h,b);c.setSource(a)}else TOP.showMessage(b.message);++f>=g&&"function"==typeof d&&(e.close(),d())},error:function(){++f>=g&&"function"==typeof d&&e.close();TOP.showMessage(TOP.TEXT.PROCESSING_ERROR);return!1}}),f>=g&&d()):++f}}
function whileUploading(a,c,d,b){return null!=a&&a.isUploading()?(b&&b.find(":input").attr("disabled",!0),a.setParam("upload_complete_handler",function(){var a=this.getStats();0==a.files_queued&&!a.in_progress&&(b&&b.find(":input").attr("disabled",!1),"function"==typeof d&&d())}),c=['<div class="msg-progress" id="msg-progress"><div></div></div><span id="msg-txt-progress">0%</span>',c,' [<a href="javascript:void(0);">'+TOP.TEXT.CANCEL+"</a>]"].join(""),TOP.showMessage(c,0,"success"),c=a.totalProgress(),
TOP.getJQ()("#msg-progress div").width(c+"%"),TOP.getJQ()("#msg-txt-progress").text(c+"%"),TOP.getJQ()("#result-top a").click(function(){TOP.showMessage();a.setParam("upload_complete_handler",function(){}).setParam("upload_progress_handler",function(b,c,d){TOP.getJQ()("#msg-progress").size()&&TOP.getJQ()("#msg-progress div").style("width",a.totalProgress+"%");a.onProgress.call(this,b,c,d)});b&&b.find(":input").attr("disabled",!1)}),!1):!0};
